'''
Mesh test
=========

This demonstrates the use of a mesh mode to distort an image. You should see
a line of buttons across the bottom of a canvas. Pressing them displays
the mesh, a small circle of points, with different mesh.mode settings.
'''

from kivy.uix.button import Button
from kivy.uix.widget import Widget
from kivy.uix.boxlayout import BoxLayout
from kivy.app import App
from kivy.graphics import Mesh
from functools import partial
from kivy.core.image import Image as CoreImage
from math import cos, sin, pi


class MeshTestApp(App):

    def change_mode(self, mode, *largs):
        self.mesh.mode = mode

    def build_mesh(self, vertices):
        # vertices = [182.000000, 10.000000, 0.712526, 0.003040, 182.000000, 182.000000, 0.712526, 0.525836, 10.000000, 10.000000, 0.359343, 0.003040, 10.000000, 182.000000, 0.359343, 0.525836]
        indices = [1, 0, 2, 1, 2, 3]
        # tl → bl → tr → br
        # bl → tl → tr
        # bl → tr → br
        texture = CoreImage('../../res/lwf/lwf_ef_ui_battle_chara_active.png').texture
        return Mesh(vertices=vertices, indices=indices, texture=texture, mode='triangle_fan')

    def build(self):
        wid = Widget()

        vertice_array = [
            [182.000000, 10.000000, 0.712526, 0.003040, 182.000000, 182.000000, 0.712526, 0.525836, 10.000000, 10.000000, 0.359343, 0.003040, 10.000000, 182.000000, 0.359343, 0.525836],
            [182.000000, 10.000000, 0.712526, 0.003040, 182.000000, 182.000000, 0.712526, 0.525836, 10.000000, 10.000000, 0.359343, 0.003040, 10.000000, 182.000000, 0.359343, 0.525836],
            [182.000000, 10.000000, 0.712526, 0.003040, 182.000000, 182.000000, 0.712526, 0.525836, 10.000000, 10.000000, 0.359343, 0.003040, 10.000000, 182.000000, 0.359343, 0.525836],
            [182.000000, 10.000000, 0.355236, 0.003040, 182.000000, 182.000000, 0.355236, 0.525836, 10.000000, 10.000000, 0.002053, 0.003040, 10.000000, 182.000000, 0.002053, 0.525836],
            [177.000000, 10.000000, 0.601643, 0.881459, 177.000000, 37.000000, 0.601643, 0.963526, 28.000000, 10.000000, 0.295688, 0.881459, 28.000000, 37.000000, 0.295688, 0.963526],
            [177.000000, 10.000000, 0.601643, 0.881459, 177.000000, 37.000000, 0.601643, 0.963526, 28.000000, 10.000000, 0.295688, 0.881459, 28.000000, 37.000000, 0.295688, 0.963526],
            [177.000000, 10.000000, 0.601643, 0.881459, 177.000000, 37.000000, 0.601643, 0.963526, 28.000000, 10.000000, 0.295688, 0.881459, 28.000000, 37.000000, 0.295688, 0.963526],
            [177.000000, 10.000000, 0.601643, 0.881459, 177.000000, 37.000000, 0.601643, 0.963526, 28.000000, 10.000000, 0.295688, 0.881459, 28.000000, 37.000000, 0.295688, 0.963526],
            [177.000000, 10.000000, 0.601643, 0.881459, 177.000000, 37.000000, 0.601643, 0.963526, 28.000000, 10.000000, 0.295688, 0.881459, 28.000000, 37.000000, 0.295688, 0.963526],
            [177.000000, 10.000000, 0.601643, 0.881459, 177.000000, 37.000000, 0.601643, 0.963526, 28.000000, 10.000000, 0.295688, 0.881459, 28.000000, 37.000000, 0.295688, 0.963526],
        ]

        with wid.canvas:
            for vertices in vertice_array:
                self.build_mesh(vertices)

        return wid


if __name__ == '__main__':
    MeshTestApp().run()
