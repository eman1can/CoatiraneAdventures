#:import PreviewButton uix.modules.preview_button.PreviewButton
#:import Refs refs.Refs

<SquareCharacterPreview>:
    Image:
        id: background
        allow_stretch: True
        source: root.background_source
    AsyncImage:
        id: char_image
        allow_stretch: True
        source: root.char_image_source
    Image:
        id: overlay
        allow_stretch: True
        source: root.overlay_source
    PreviewButton:
        id: char_button
        path: root.char_button_source
        collision_source: root.char_button_collide_image
        on_left_click: root.handle_preview_click()
        on_right_click: Refs.gs.display_screen('char_attr_' + root.character.get_id(), True, True, root.character, root.preview)
    Image:
        id: stat_image
        allow_stretch: True
        source: root.stat_image_source
        size_hint: 0.16, 0.16
        pos_hint: {'x': 0.055, 'top': 0.98}
        opacity: 0 if root.stat_image_source == '' else 1 if root.has_stat else 0
    Label:
        id: stat_label
        text: root.stat_text
        opacity: 1 if root.has_stat else 0
        color: 0.796, 0.773, 0.678, 1
        font_name: 'Gabriola'
        font_size: root.height * 0.14
        size_hint_x: 1 if root.stat_type == 'Name' else 0.392 if root.stat_image_source == '' else 0.232
        size_hint_y: None
        height: self.texture_size[1]
        pos_hint: {'center_x': 0.5, 'center_y': 0.9} if root.stat_type == 'Name' else {'right': 0.5, 'center_y': 0.9}
    Label:
        id: stat_numbers
        text: str(round(root.stat_number, 2))
        opacity: 0 if root.stat_type == 'Name' else 0 if root.stat_type == 'Party' else 0 if root.stat_type == 'Rank' else 1 if root.has_stat else 0
        color: 0.796, 0.773, 0.678, 1
        font_name: 'Gabriola'
        font_size: root.height * 0.14
        size_hint_x: 0.48
        size_hint_y: None
        height: self.texture_size[1]
        pos_hint: {'right': 0.98, 'center_y': 0.9}
    Label:
        id: tag
        text: '[b]Selected[/b]' if root.has_tag else ''
        markup: True
        color: app.get_dkey('scp.tag c')
        outline_color: app.get_dkey('scp.tag oc')
        outline_width: app.get_dkey('scp.tag ow')
        font_size: app.get_dkey('scp.tag fs', root.height)
        size_hint: app.get_dkey('scp.tag s_h')
        pos_hint: app.get_dkey('scp.tag p_h')